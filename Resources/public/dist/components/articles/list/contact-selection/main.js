define(["jquery","text!/admin/api/contacts/fields"],function(a,b){"use strict";var c={options:{data:{contact:null},selectCallback:function(a){},matchings:JSON.parse(b)},translations:{title:"sulu_article.contact-selection-overlay.title"},templates:{skeleton:['<div class="grid">','   <div class="grid-row search-row">','       <div class="grid-col-8"/>','       <div class="grid-col-4 contact-selection-search"/>',"   </div>",'   <div class="grid-row">','       <div class="grid-col-12 contact-selection-list"/>',"   </div>","</div>"].join("")}};return{defaults:c,initialize:function(){var b=a("<div/>");this.$el.append(b),this.data=this.options.data,this.sandbox.start([{name:"overlay@husky",options:{el:b,instanceName:"contact-selection",openOnStart:!0,removeOnClose:!0,skin:"medium",slides:[{title:this.translations.title,data:a(this.templates.skeleton({translations:this.translations})),okCallback:this.okCallbackOverlay.bind(this)}]}}]),this.sandbox.once("husky.overlay.contact-selection.opened",function(){this.sandbox.start([{name:"search@husky",options:{el:b.find(".contact-selection-search"),appearance:"white small",instanceName:"contact-selection-search"}},{name:"datagrid@husky",options:{el:b.find(".contact-selection-list"),instanceName:"contact-selection",url:"/admin/api/contacts?flat=true",resultKey:"contacts",sortable:!1,selectedCounter:!1,searchInstanceName:"contact-selection-search",searchFields:["fullName","mainEmail"],preselected:this.options.data.contact?[this.options.data.contact.id]:[],paginationOptions:{dropdown:{limit:20}},viewOptions:{table:{selectItem:{type:"radio"}}},matchings:this.options.matchings}}])}.bind(this))},okCallbackOverlay:function(){this.sandbox.emit("husky.datagrid.contact-selection.items.get-selected",function(a,b){b.length>0&&(this.data.contactId=a[0],this.data.contactItem=b[0]),this.options.selectCallback(this.data),this.sandbox.stop()}.bind(this),!0)}}});