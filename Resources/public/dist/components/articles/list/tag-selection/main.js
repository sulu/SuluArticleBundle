define(["jquery","text!/admin/api/tags/fields"],function(a,b){"use strict";var c={options:{data:{tag:null},selectCallback:function(a){},matchings:JSON.parse(b)},translations:{title:"sulu_article.tag-selection-overlay.title"},templates:{skeleton:['<div class="grid">','   <div class="grid-row search-row">','       <div class="grid-col-8"/>','       <div class="grid-col-4 tag-selection-search"/>',"   </div>",'   <div class="grid-row">','       <div class="grid-col-12 tag-selection-list"/>',"   </div>","</div>"].join("")}};return{defaults:c,initialize:function(){var b=a("<div/>");this.$el.append(b),this.data=this.options.data,this.sandbox.start([{name:"overlay@husky",options:{el:b,instanceName:"tag-selection",openOnStart:!0,removeOnClose:!0,skin:"medium",slides:[{title:this.translations.title,data:a(this.templates.skeleton({translations:this.translations})),okCallback:this.okCallbackOverlay.bind(this)}]}}]),this.sandbox.once("husky.overlay.tag-selection.opened",function(){this.sandbox.start([{name:"search@husky",options:{el:b.find(".tag-selection-search"),appearance:"white small",instanceName:"tag-selection-search"}},{name:"datagrid@husky",options:{el:b.find(".tag-selection-list"),instanceName:"tag-selection",url:"/admin/api/tags?flat=true",resultKey:"tags",sortable:!1,selectedCounter:!1,searchInstanceName:"tag-selection-search",searchFields:["name"],preselected:this.options.data.tag?[this.options.data.tag.id]:[],paginationOptions:{dropdown:{limit:20}},viewOptions:{table:{selectItem:{type:"radio"}}},matchings:this.options.matchings}}])}.bind(this))},okCallbackOverlay:function(){this.sandbox.emit("husky.datagrid.tag-selection.items.get-selected",function(a,b){b.length>0&&(this.data.tagId=a[0],this.data.tagItem=b[0]),this.options.selectCallback(this.data),this.sandbox.stop()}.bind(this),!0)}}});