define(["underscore","config","services/suluarticle/list-helper","services/suluarticle/overlay-filter-helper"],function(a,b,c,d){"use strict";var e={options:{locale:null,url:"",resultKey:null,searchFields:[],instanceName:"teaser-selection",selectCallback:function(a){}},templates:{skeleton:['<div class="teaser-selection-tabs"></div>','<div class="grid">','   <div class="grid-row search-row">','       <div class="grid-col-12 teaser-selection-search"/>',"   </div>",'   <div class="grid-row">','       <div class="grid-col-12 teaser-selection-list"/>',"   </div>","</div>"].join("")},translations:{filterAll:"sulu_article.list.filter.all",filterByTimescale:"sulu_article.list.filter.by-timescale",published:"public.published",unpublished:"public.unpublished",filterMe:"sulu_article.list.filter.me",filterByAuthor:"sulu_article.list.filter.by-author",filterByCategory:"sulu_article.list.filter.by-category",filterByTag:"sulu_article.list.filter.by-tag",filterByPage:"sulu_article.list.filter.by-page"}},f=b.get("sulu_article"),g=function(){if(1===f.typeNames.length)return[];var b=[];return f.displayTabAll===!0&&b.push({id:"all",name:"public.all"}),a.each(f.typeNames,function(a){b.push({id:a,name:f.types[a].title})}.bind(this)),b};return{defaults:e,filter:{},initialize:function(){this.$el.parent().removeClass("content-spacing"),this.$el.parent().addClass("article-teaser-selection"),this.filterHelper=d.create(this.$el,this.options.instanceName,this.options.locale,"sulu_content.teaser-selection");var b=$(this.templates.skeleton());this.$el.append(b);var e=this.filterHelper.createToolbarTemplate(this.sandbox);this.sandbox.sulu.initListToolbarAndList.call(this,"article","/admin/api/articles/fields",{el:".teaser-selection-search",instanceName:this.options.instanceName,template:e},{el:".teaser-selection-list",instanceName:this.options.instanceName,url:this.getUrl(),preselected:a.map(this.options.data,function(a){return a.id}),resultKey:this.options.resultKey,clickCallback:function(a){this.sandbox.emit("husky.datagrid."+this.options.instanceName+".toggle.item",a)}.bind(this),searchInstanceName:this.options.instanceName,searchFields:this.options.searchFields,paginationOptions:{dropdown:{limit:20}},viewOptions:{table:{actionIconColumn:"title",badges:[{column:"title",callback:function(a,b){return c.generateLocalizationBadge(a,b,this.options.locale)}.bind(this)},{column:"title",callback:c.generateWorkflowBadge}]}}}),this.sandbox.start([{name:"tabs@husky",options:{el:".teaser-selection-tabs",data:g(),callback:this.changeType.bind(this)}}]),this.filterHelper.startFilterComponents(this.sandbox),this.bindCustomEvents()},bindCustomEvents:function(){this.sandbox.on("husky.datagrid."+this.options.instanceName+".item.select",function(a){this.options.selectCallback({type:this.options.type,id:a})}.bind(this)),this.sandbox.on("husky.datagrid."+this.options.instanceName+".item.deselect",function(a){this.options.deselectCallback({type:this.options.type,id:a})}.bind(this)),this.sandbox.on("sulu_content.teaser-selection."+this.options.instanceName+".cancel-button.clicked",function(){this.$el.parent().removeClass("limited"),this.sandbox.emit("husky.overlay."+this.options.instanceName+".slide-to",0)}.bind(this))},getUrl:function(){return this.options.url.replace("{locale}",this.options.locale)},changeType:function(a){var b=a.id;"all"===a.id&&(b=null),this.sandbox.emit("husky.datagrid."+this.options.instanceName+".url.update",{type:b})}}});