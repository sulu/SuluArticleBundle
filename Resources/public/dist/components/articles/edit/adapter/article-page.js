define(["underscore","services/suluarticle/article-manager","services/sulupreview/preview"],function(a,b,c){"use strict";var d=function(a,b){return!a||!b._embedded||b._embedded.pages.length<=a-2?{}:b._embedded.pages[a-2]};return{getCopyLocaleUrl:function(a,c,d,e){return b.getCopyPageLocaleUrl(a,c,d,e)},startPreview:function(a,b){var e=d(a.options.page,b);e.type&&"ghost"===e.type.name&&(e={id:e.id});var f=c.initialize({});return f.start("Sulu\\Bundle\\ArticleBundle\\Document\\ArticlePageDocument",e.id,a.options.locale,e),f},destroyPreview:function(a){c.destroy(a)},beforeFormCreate:function(a){var b=a.getTitleProperty(),c=a.getRoutePathProperty();b&&b.$el.parent().remove(),c&&c.$el.parent().remove(),0===a.$el.find(".section-highlight *[data-mapper-property]").length&&a.$el.find(".highlight-section").remove()},prepareData:function(a,b){return d(b.options.page,a)},save:function(a,c,d){var e=null,f=a.options.page-2;return a.data._embedded.pages[f]&&(e=a.data._embedded.pages[f].id),c.template=a.template,b.savePage(c,a.data.id,e,a.options.locale,d).then(function(){return b.loadSync(a.data.id,a.options.locale).responseJSON})}}});