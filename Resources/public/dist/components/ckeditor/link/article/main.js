define(["config","services/suluarticle/article-manager","text!/admin/api/articles/fields"],function(a,b,c){"use strict";var d=JSON.parse(c),e=a.get("sulu_article");return{defaults:{options:{link:{},locale:null,webspace:null,setHref:function(a,b,c){},selectCallback:function(a,b){}},templates:{contentDatasource:['<div class="grid">','   <div class="grid-row search-row">','       <div class="grid-col-8"/>','       <div id="href-select-search" class="grid-col-4"/>',"   </div>",'   <div class="grid-row">','       <div id="href-select" class="grid-col-12" style="max-height: 500px; overflow: scroll;"/>',"   </div>","</div>"].join("")}},initialize:function(){this.bindCustomEvents(),this.resolveHref(),this.render()},bindCustomEvents:function(){this.sandbox.on("husky.tabs.overlayinternal-link.item.select",this.typeChange.bind(this))},resolveHref:function(){return this.options.link.href?void b.load(this.options.link.href,this.options.locale).then(function(a){this.options.setHref(a.id,a.title,!0)}.bind(this)):void this.options.setHref()},render:function(){var a=$(this.templates.contentDatasource());this.$el.append(a);var c="";e.typeNames.length>0&&(this.type=e.typeNames[0],c="&type="+e.typeNames[0]),this.sandbox.start([{name:"search@husky",options:{el:"#href-select-search",appearance:"white small",instanceName:"article-link-search"}},{name:"datagrid@husky",options:{el:"#href-select",instanceName:"article-link",url:b.url({locale:this.options.locale})+"&sortBy=authored&sortOrder=desc"+c,resultKey:"articles",clickCallback:function(a,b){this.options.selectCallback(a,b.title,!0)}.bind(this),selectedCounter:!0,searchInstanceName:"article-link-search",searchFields:["id","title"],paginationOptions:{dropdown:{limit:20}},viewOptions:{table:{selectItem:!1}},matchings:d}}])},typeChange:function(a){for(var b in e.types)if(e.types.hasOwnProperty(b)&&e.types[b].title===a.name&&this.type!==b)return this.type=b,this.sandbox.emit("husky.datagrid.article-link.url.update",{type:b});this.type=null,this.sandbox.emit("husky.datagrid.article-link.url.update",{type:null})}}});